<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - DEBUG MODE</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    .debug-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 400px;
      height: 100vh;
      background: #1a1a1a;
      color: #0f0;
      padding: 20px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
      border-left: 3px solid #0f0;
    }
    .debug-log {
      margin: 5px 0;
      padding: 5px;
      border-bottom: 1px solid #333;
    }
    .debug-success { color: #0f0; }
    .debug-error { color: #f00; }
    .debug-warning { color: #ff0; }
    .debug-info { color: #0ff; }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="debug" class="debug-panel"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Sistema de Debug
    const debugLog = (message, type = 'info') => {
      console.log(`[DEBUG ${type.toUpperCase()}]`, message);
      const debugPanel = document.getElementById('debug');
      const logEntry = document.createElement('div');
      logEntry.className = `debug-log debug-${type}`;
      logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      debugPanel.appendChild(logEntry);
      debugPanel.scrollTop = debugPanel.scrollHeight;
    };

    function AdminDashboard() {
      debugLog('üöÄ AdminDashboard component iniciado', 'success');
      
      // ============================================
      // CONFIGURA√á√ÉO
      // ============================================
      
      const GOOGLE_APPS_SCRIPT_URL = 'COLE_AQUI_A_URL_DO_SEU_GOOGLE_APPS_SCRIPT';
      const ADMIN_PASSWORD = 'hupdata2024';
      
      debugLog(`üìù URL configurada: ${GOOGLE_APPS_SCRIPT_URL.substring(0, 30)}...`, 'info');
      
      // ============================================
      // ESTADO
      // ============================================
      
      const [isAuthenticated, setIsAuthenticated] = useState(() => {
        const auth = localStorage.getItem('admin_authenticated') === 'true';
        debugLog(`üîê Estado inicial autentica√ß√£o: ${auth}`, 'info');
        return auth;
      });
      const [password, setPassword] = useState('');
      const [leads, setLeads] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      
      debugLog('‚úÖ Estados inicializados', 'success');
      
      // ============================================
      // AUTENTICA√á√ÉO
      // ============================================
      
      const handleLogin = (e) => {
        e.preventDefault();
        debugLog(`üîë Tentativa de login com senha: ${password.substring(0, 3)}...`, 'info');
        
        if (password === ADMIN_PASSWORD) {
          debugLog('‚úÖ Senha correta!', 'success');
          localStorage.setItem('admin_authenticated', 'true');
          setIsAuthenticated(true);
        } else {
          debugLog('‚ùå Senha incorreta!', 'error');
          alert('Senha incorreta!');
        }
      };
      
      const handleLogout = () => {
        debugLog('üëã Logout realizado', 'info');
        localStorage.removeItem('admin_authenticated');
        setIsAuthenticated(false);
        setLeads([]);
      };
      
      // ============================================
      // BUSCAR LEADS
      // ============================================
      
      const fetchLeads = async () => {
        debugLog('üì• Iniciando fetchLeads...', 'info');
        
        if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'COLE_AQUI_A_URL_DO_SEU_GOOGLE_APPS_SCRIPT') {
          debugLog('‚ö†Ô∏è URL n√£o configurada!', 'warning');
          alert('Configure a URL do Google Apps Script no c√≥digo!');
          return;
        }
        
        setLoading(true);
        debugLog('‚è≥ Loading = true', 'info');
        
        try {
          debugLog(`üåê Fazendo GET para: ${GOOGLE_APPS_SCRIPT_URL}`, 'info');
          const response = await fetch(GOOGLE_APPS_SCRIPT_URL);
          
          debugLog(`üì° Resposta recebida - Status: ${response.status}`, response.ok ? 'success' : 'error');
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const data = await response.json();
          debugLog(`üìä Dados parseados - success: ${data.success}, total: ${data.total}`, 'info');
          
          if (data.success) {
            const leadsArray = data.leads || [];
            debugLog(`‚úÖ ${leadsArray.length} leads recebidos`, 'success');
            
            // Log dos campos do primeiro lead
            if (leadsArray.length > 0) {
              debugLog('üìã Campos do primeiro lead:', 'info');
              Object.keys(leadsArray[0]).forEach(key => {
                debugLog(`  - ${key}: ${leadsArray[0][key]}`, 'info');
              });
            }
            
            setLeads(leadsArray);
            debugLog('‚úÖ setLeads() executado', 'success');
          } else {
            debugLog(`‚ùå API retornou erro: ${data.message}`, 'error');
            setError(data.message || 'Erro desconhecido');
          }
          
        } catch (err) {
          debugLog(`‚ùå ERRO CATCH: ${err.message}`, 'error');
          debugLog(`Stack: ${err.stack}`, 'error');
          setError(err.message);
          setLeads([]);
        } finally {
          setLoading(false);
          debugLog('‚è≥ Loading = false', 'info');
        }
      };
      
      // ============================================
      // EFFECTS
      // ============================================
      
      useEffect(() => {
        debugLog('üîÑ useEffect disparado', 'info');
        if (isAuthenticated) {
          debugLog('‚úÖ Autenticado - chamando fetchLeads', 'info');
          fetchLeads();
        } else {
          debugLog('‚è∏Ô∏è N√£o autenticado - n√£o busca leads', 'warning');
        }
      }, [isAuthenticated]);
      
      // ============================================
      // RENDERIZA√á√ÉO
      // ============================================
      
      debugLog('üé® Iniciando renderiza√ß√£o...', 'info');
      
      // Tela de erro
      if (error) {
        debugLog(`‚ö†Ô∏è Renderizando tela de erro: ${error}`, 'warning');
        return (
          <div className="min-h-screen bg-red-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-xl shadow-xl p-8 max-w-md w-full">
              <div className="text-center">
                <div className="text-6xl mb-4">‚ö†Ô∏è</div>
                <h1 className="text-2xl font-bold text-gray-900 mb-4">Erro</h1>
                <p className="text-gray-600 mb-6">{error}</p>
                <button
                  onClick={() => {
                    debugLog('üîÑ Reset de erro', 'info');
                    setError(null);
                    fetchLeads();
                  }}
                  className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                >
                  Tentar Novamente
                </button>
              </div>
            </div>
          </div>
        );
      }
      
      // Tela de login
      if (!isAuthenticated) {
        debugLog('üîê Renderizando tela de login', 'info');
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-900 to-blue-800 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
              <div className="text-center mb-8">
                <h1 className="text-2xl font-bold text-gray-900 mb-2">Admin Dashboard</h1>
                <p className="text-gray-600">DEBUG MODE</p>
              </div>
              
              <form onSubmit={handleLogin}>
                <div className="mb-6">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Senha de Acesso
                  </label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg"
                    placeholder="hupdata2024"
                    required
                  />
                </div>
                
                <button
                  type="submit"
                  className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700"
                >
                  Entrar
                </button>
              </form>
            </div>
          </div>
        );
      }
      
      // Dashboard principal
      debugLog('üìä Renderizando dashboard principal', 'info');
      debugLog(`üìã Total de leads no estado: ${leads.length}`, 'info');
      
      try {
        return (
          <div className="min-h-screen bg-gray-50 pr-96">
            {/* Header */}
            <div className="bg-white shadow-sm border-b">
              <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div>
                  <h1 className="text-xl font-bold text-gray-900">Admin Dashboard - DEBUG</h1>
                  <p className="text-sm text-gray-600">Modo de diagn√≥stico</p>
                </div>
                
                <div className="flex gap-2">
                  <button
                    onClick={fetchLeads}
                    disabled={loading}
                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
                  >
                    {loading ? 'Carregando...' : 'Atualizar'}
                  </button>
                  
                  <button
                    onClick={handleLogout}
                    className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
                  >
                    Sair
                  </button>
                </div>
              </div>
            </div>
            
            {/* Content */}
            <div className="max-w-7xl mx-auto p-6">
              {/* Stats */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div className="bg-white p-6 rounded-xl shadow">
                  <div className="text-sm text-gray-600 mb-2">Total de Leads</div>
                  <div className="text-3xl font-bold text-gray-900">{leads.length}</div>
                </div>
                
                <div className="bg-white p-6 rounded-xl shadow">
                  <div className="text-sm text-gray-600 mb-2">Status</div>
                  <div className="text-lg font-bold text-green-600">
                    {loading ? 'Carregando...' : 'Conectado'}
                  </div>
                </div>
                
                <div className="bg-white p-6 rounded-xl shadow">
                  <div className="text-sm text-gray-600 mb-2">Debug Panel</div>
                  <div className="text-lg font-bold text-blue-600">Ativo ‚Üí</div>
                </div>
              </div>
              
              {/* Leads Table */}
              <div className="bg-white rounded-xl shadow overflow-hidden">
                <div className="p-6 border-b">
                  <h2 className="text-lg font-bold text-gray-900">Leads Capturados</h2>
                </div>
                
                {loading ? (
                  <div className="p-12 text-center">
                    <div className="text-gray-500">Carregando dados...</div>
                  </div>
                ) : leads.length === 0 ? (
                  <div className="p-12 text-center">
                    <div className="text-6xl mb-4">üì≠</div>
                    <div className="text-gray-500">Nenhum lead encontrado</div>
                    <button
                      onClick={fetchLeads}
                      className="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                    >
                      Buscar Novamente
                    </button>
                  </div>
                ) : (
                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                          <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                          <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Empresa</th>
                          <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">√Årea</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-gray-200">
                        {leads.map((lead, index) => {
                          debugLog(`üé® Renderizando lead ${index + 1}`, 'info');
                          return (
                            <tr key={index} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap">
                                {lead.Nome || lead.nome || '-'}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                {lead.Email || lead.email || '-'}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                {lead.Empresa || lead.empresa || '-'}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                {lead.√Årea || lead['√Årea'] || lead.area || '-'}
                              </td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      } catch (renderError) {
        debugLog(`‚ùå ERRO DE RENDERIZA√á√ÉO: ${renderError.message}`, 'error');
        debugLog(`Stack: ${renderError.stack}`, 'error');
        
        return (
          <div className="min-h-screen bg-red-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-xl shadow-xl p-8 max-w-md w-full">
              <div className="text-center">
                <div className="text-6xl mb-4">üí•</div>
                <h1 className="text-2xl font-bold text-gray-900 mb-4">Erro de Renderiza√ß√£o</h1>
                <p className="text-gray-600 mb-4">{renderError.message}</p>
                <pre className="text-xs text-left bg-gray-100 p-4 rounded overflow-x-auto mb-4">
                  {renderError.stack}
                </pre>
                <button
                  onClick={() => window.location.reload()}
                  className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                >
                  Recarregar P√°gina
                </button>
              </div>
            </div>
          </div>
        );
      }
    }
    
    // Inicializa√ß√£o
    debugLog('üé¨ Inicializando aplica√ß√£o...', 'info');
    
    try {
      ReactDOM.render(<AdminDashboard />, document.getElementById('root'));
      debugLog('‚úÖ React montado com sucesso!', 'success');
    } catch (mountError) {
      debugLog(`‚ùå ERRO AO MONTAR REACT: ${mountError.message}`, 'error');
      document.getElementById('root').innerHTML = `
        <div style="padding: 40px; text-align: center;">
          <h1 style="color: red;">ERRO CR√çTICO</h1>
          <p>${mountError.message}</p>
          <pre style="text-align: left; background: #f0f0f0; padding: 20px; overflow: auto;">
            ${mountError.stack}
          </pre>
        </div>
      `;
    }
  </script>
</body>
</html>
